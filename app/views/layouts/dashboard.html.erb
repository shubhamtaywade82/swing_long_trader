<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Swing Long Trader - Dashboard" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Swing Long Trader">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
  </head>

  <body data-controller="dashboard" data-dashboard-channel-value="DashboardChannel">
    <div class="dashboard-wrapper">
      <!-- Side Navigation -->
      <nav class="sidebar" data-dashboard-target="sidebar">
        <div class="sidebar-header">
          <h4 class="sidebar-title" data-dashboard-target="sidebarTitle">
            <i class="bi bi-graph-up-arrow"></i>
            <span class="sidebar-title-text">Swing Trader</span>
          </h4>
          <div class="sidebar-header-actions">
            <button class="btn btn-link sidebar-collapse-toggle d-none d-md-block"
                    data-action="click->dashboard#toggleSidebarCollapse"
                    data-dashboard-target="sidebarCollapseBtn"
                    title="Collapse sidebar">
              <i class="bi bi-chevron-left"></i>
            </button>
            <button class="btn btn-link sidebar-toggle d-md-none" data-action="click->dashboard#toggleSidebar">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>

        <ul class="sidebar-nav">
          <li class="nav-item">
            <%= link_to dashboard_path, class: "nav-link #{'active' if current_page?(dashboard_path)}", data: { tooltip: "Dashboard" } do %>
              <i class="bi bi-speedometer2"></i>
              <span class="nav-link-text">Dashboard</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to positions_path, class: "nav-link #{'active' if current_page?(positions_path)}", data: { tooltip: "Positions" } do %>
              <i class="bi bi-briefcase"></i>
              <span class="nav-link-text">Positions</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to portfolio_path, class: "nav-link #{'active' if current_page?(portfolio_path)}", data: { tooltip: "Portfolio" } do %>
              <i class="bi bi-pie-chart"></i>
              <span class="nav-link-text">Portfolio</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to signals_path, class: "nav-link #{'active' if current_page?(signals_path)}", data: { tooltip: "Trading Signals" } do %>
              <i class="bi bi-bullseye"></i>
              <span class="nav-link-text">Trading Signals</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to ai_evaluations_path, class: "nav-link #{'active' if current_page?(ai_evaluations_path)}", data: { tooltip: "AI Evaluations" } do %>
              <i class="bi bi-robot"></i>
              <span class="nav-link-text">AI Evaluations</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to orders_path, class: "nav-link #{'active' if current_page?(orders_path)}", data: { tooltip: "Orders" } do %>
              <i class="bi bi-list-check"></i>
              <span class="nav-link-text">Orders</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to monitoring_path, class: "nav-link #{'active' if current_page?(monitoring_path)}", data: { tooltip: "Monitoring" } do %>
              <i class="bi bi-activity"></i>
              <span class="nav-link-text">Monitoring</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to about_path, class: "nav-link #{'active' if current_page?(about_path)}", data: { tooltip: "About" } do %>
              <i class="bi bi-info-circle"></i>
              <span class="nav-link-text">About</span>
            <% end %>
          </li>
          <li class="nav-item nav-section-header">
            <span class="nav-section-title">Screeners</span>
          </li>
          <li class="nav-item">
            <%= link_to swing_screener_path, class: "nav-link #{'active' if current_page?(swing_screener_path)}", data: { tooltip: "Swing Screener" } do %>
              <i class="bi bi-graph-up"></i>
              <span class="nav-link-text">Swing Screener</span>
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to longterm_screener_path, class: "nav-link #{'active' if current_page?(longterm_screener_path)}", data: { tooltip: "Long-Term Screener" } do %>
              <i class="bi bi-graph-up-arrow"></i>
              <span class="nav-link-text">Long-Term Screener</span>
            <% end %>
          </li>
        </ul>
      </nav>

      <!-- Main Content Area -->
      <div class="main-content">
        <!-- Header -->
        <header class="dashboard-header">
          <div class="header-left">
            <button class="btn btn-link sidebar-toggle-mobile d-md-none" data-action="click->dashboard#toggleSidebar">
              <i class="bi bi-list"></i>
            </button>
            <h1 class="page-title"><%= content_for(:page_title) || "Dashboard" %></h1>
          </div>
          <div class="header-right">
            <!-- Trading Mode Toggle -->
            <div class="trading-mode-toggle">
              <button type="button"
                      class="btn btn-sm <%= current_trading_mode == 'live' ? 'btn-danger' : 'btn-info' %> trading-mode-btn"
                      data-action="click->dashboard#toggleTradingMode"
                      data-dashboard-target="tradingModeBtn"
                      data-mode="<%= current_trading_mode %>"
                      title="Toggle between Live and Paper trading mode">
                <i class="bi bi-<%= current_trading_mode == 'live' ? 'lightning-charge' : 'file-earmark-text' %>"></i>
                <span class="mode-text"><%= current_trading_mode.upcase %></span>
              </button>
            </div>
            <div class="connection-status" data-dashboard-target="connectionStatus">
              <span class="status-indicator"></span>
              <span class="status-text">Connected</span>
            </div>
            <div class="current-time" data-dashboard-target="currentTime">
              <%= Time.current.strftime("%H:%M:%S") %>
            </div>
          </div>
        </header>

        <!-- Page Content -->
        <main class="content-area" data-dashboard-target="contentArea">
          <%= yield %>
        </main>
      </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay d-md-none" data-dashboard-target="overlay" data-action="click->dashboard#closeSidebar"></div>
  </body>
</html>
