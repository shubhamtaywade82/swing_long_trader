default: &default
  dispatchers:
    - polling_interval: 1
      batch_size: 500
  workers:
    # Process specific queues with controlled concurrency
    # Use QUEUES env var to override (e.g., QUEUES=screener,ai_evaluation)
    - queues: <%= ENV.fetch("QUEUES", "*") %>
      threads: <%= ENV.fetch("RAILS_MAX_THREADS", 5).to_i %>
      processes: <%= ENV.fetch("JOB_CONCURRENCY", 1).to_i %>
      polling_interval: 0.1

development:
  <<: *default
  # In development, process all queues with lower concurrency
  workers:
    - queues: "*"
      threads: 3
      processes: 1
      polling_interval: 0.1

test:
  <<: *default
  workers:
    - queues: "*"
      threads: 2
      processes: 1
      polling_interval: 0.1

production:
  <<: *default
  # In production, respect environment variables for queue control
  # Default: process all queues with 5 threads, 1 process
  # Override with: QUEUES=screener,ai_evaluation RAILS_MAX_THREADS=3
  workers:
    - queues: <%= ENV.fetch("QUEUES", "*") %>
      threads: <%= ENV.fetch("RAILS_MAX_THREADS", 5).to_i %>
      processes: <%= ENV.fetch("JOB_CONCURRENCY", 1).to_i %>
      polling_interval: 0.1
