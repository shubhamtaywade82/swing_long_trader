# frozen_string_literal: true

# SolidQueue recurring jobs configuration
# Schedule format: "minute hour day month weekday" (cron-like)
# IST timezone (UTC+5:30) - adjust times accordingly
# Examples:
#   periodic_cleanup:
#     class: CleanSoftDeletedRecordsJob
#     queue: background
#     args: [ 1000, { batch_size: 500 } ]
#     schedule: every hour
#   periodic_cleanup_with_command:
#     command: "SoftDeletedRecord.due.delete_all"
#     priority: 2
#     schedule: at 5am every day

production:
  # Daily candle ingestion - 07:30 IST daily (cron: 30 7 * * *)
  daily_candle_ingestion:
    class: Candles::DailyIngestorJob
    schedule: "30 7 * * *"
    queue: default
    priority: 0

  # Weekly candle ingestion - 07:30 IST Monday (cron: 30 7 * * 1)
  weekly_candle_ingestion:
    class: Candles::WeeklyIngestorJob
    schedule: "30 7 * * 1"
    queue: default
    priority: 0

  # Swing screener - 07:40 IST weekdays Monday-Friday (cron: 40 7 * * 1-5)
  swing_screener:
    class: Screeners::SwingScreenerJob
    schedule: "40 7 * * 1-5"
    queue: default
    priority: 0

  # Monitor job - Every 30 minutes during market hours 9:00 AM - 3:30 PM IST, weekdays (cron: */30 9-15 * * 1-5)
  monitor_job:
    class: MonitorJob
    schedule: "*/30 9-15 * * 1-5"
    queue: default
    priority: 1

  # Clean finished SolidQueue jobs - Every hour at minute 12 (cron: 12 * * * *)
  clear_solid_queue_finished_jobs:
    command: "SolidQueue::Job.clear_finished_in_batches(sleep_between_batches: 0.3)"
    schedule: "12 * * * *"
    priority: 2

  # Optional: Intraday fetcher (commented out - on-demand only)
  # intraday_fetcher:
  #   class: Candles::IntradayFetcherJob
  #   schedule: at 7:45am on weekdays
  #   queue: default
  #   priority: 0

  # Swing entry monitor - Automatic trading during market hours
  swing_entry_monitor:
    class: Strategies::Swing::EntryMonitorJob
    schedule: "*/30 9-15 * * 1-5"  # Every 30 minutes, 9 AM - 3:30 PM IST, weekdays
    queue: default
    priority: 1

  # Swing exit monitor - Automatic exit monitoring during market hours
  swing_exit_monitor:
    class: Strategies::Swing::ExitMonitorJob
    schedule: "*/30 9-15 * * 1-5"  # Every 30 minutes, 9 AM - 3:30 PM IST, weekdays
    queue: default
    priority: 1

  # Position sync - Sync live positions with DhanHQ and reconcile prices
  position_sync:
    class: Positions::SyncJob
    schedule: "*/15 9-15 * * 1-5"  # Every 15 minutes, 9 AM - 3:30 PM IST, weekdays
    queue: default
    priority: 1
    args: ["all"]  # Sync both live and paper

development:
  # Same as production for development testing
  daily_candle_ingestion:
    class: Candles::DailyIngestorJob
    schedule: "30 7 * * *"
    queue: default
    priority: 0

  weekly_candle_ingestion:
    class: Candles::WeeklyIngestorJob
    schedule: "30 7 * * 1"
    queue: default
    priority: 0

  swing_screener:
    class: Screeners::SwingScreenerJob
    schedule: "40 7 * * 1-5"
    queue: default
    priority: 0

  monitor_job:
    class: MonitorJob
    schedule: "*/30 9-15 * * 1-5"
    queue: default
    priority: 1

  # Swing entry monitor - Automatic trading during market hours
  swing_entry_monitor:
    class: Strategies::Swing::EntryMonitorJob
    schedule: "*/30 9-15 * * 1-5"  # Every 30 minutes, 9 AM - 3:30 PM IST, weekdays
    queue: default
    priority: 1

  # Swing exit monitor - Automatic exit monitoring during market hours
  swing_exit_monitor:
    class: Strategies::Swing::ExitMonitorJob
    schedule: "*/30 9-15 * * 1-5"  # Every 30 minutes, 9 AM - 3:30 PM IST, weekdays
    queue: default
    priority: 1

  # Position sync - Sync live positions with DhanHQ and reconcile prices
  position_sync:
    class: Positions::SyncJob
    schedule: "*/15 9-15 * * 1-5"  # Every 15 minutes, 9 AM - 3:30 PM IST, weekdays
    queue: default
    priority: 1

  # Daily portfolio snapshot - Create portfolio snapshot at end of trading day
  daily_portfolio_snapshot:
    class: Portfolios::DailySnapshotJob
    schedule: "0 16 * * 1-5"  # 4:00 PM IST (after market close), weekdays
    queue: default
    priority: 2

  clear_solid_queue_finished_jobs:
    command: "SolidQueue::Job.clear_finished_in_batches(sleep_between_batches: 0.3)"
    schedule: "12 * * * *"
    priority: 2
